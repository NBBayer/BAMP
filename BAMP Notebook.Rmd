---
title: "R Notebook"
output: html_notebook
---
To compute our model we need to install the following librarys:
```{r}
library(ggplot2)
library(tidyr)
install.packages("gridExtra")
library(gridExtra)
library(readr)
install.packages("fasttime")
library(fasttime)
```

To test different approaches we start with a combination of datasets that combrise the energy consumption of the "Waldhotel Wiesman" from the year 2019 and the heating and occupancy data from the "Best Western Premium Schwarzwald 1. Halbjahr 2019". 

To apply the methods we first of all need to load the datasets:
```{r}
getwd()
## Heating and Occupancy Data
bw_heating_occupancy <- Best.Western.Premium.Schwarzwald.1..Halbjahr.2019.Zusammenfassung

## Split Heating and Occupancy Data
bw_heating <- filter(bw_heating_occupancy, KPI == c("T","Td","Val"))
bw_occupancy <- filter(bw_heating_occupancy, KPI == "Occ")


## Specify the Data Type for Heatig correctly:
bw_heating$Value <- as.numeric(bw_heating$Value)
#bw_heating$Zeit <- gsub("T", " ", bw_heating$Zeit) #-> not required for fastPOSIXct
bw_heating$Zeit <- fastPOSIXct(bw_heating$Zeit, required.components = 5L)
#bw_heating$Zeit <- as.POSIXlt(bw_heating$Zeit, format= "%Y-%m-%d %H:%M") #-> replaces by fastPOSIXct
bw_heating$idk <- as.factor(bw_heating$idk)
bw_heating$Room <- as.factor(bw_heating$Room)
bw_heating$RoomType <- as.factor(bw_heating$RoomType)
bw_heating$KPI <- as.factor(bw_heating$KPI)
summary(bw_heating)

## Specify the Data Type for Occupancy correctly:
bw_occupancy$Value <- as.factor(bw_occupancy$Value)
bw_occupancy$Zeit <- gsub("T", " ", bw_occupancy$Zeit)
bw_occupancy$Zeit <- as.POSIXlt(bw_occupancy$Zeit, format= "%Y-%m-%d %H:%M")
bw_occupancy$idk <- as.factor(bw_occupancy$idk)
bw_occupancy$Room <- as.factor(bw_occupancy$Room)
bw_occupancy$RoomType <- as.factor(bw_occupancy$RoomType)
bw_occupancy$KPI <- as.factor(bw_occupancy$KPI)
summary(bw_occupancy)

## Weather Data
Weather <- read_delim("C:/Users/Niclas Bardo Bayer/Desktop/Unsortierte Dateien/BAMP Daten Analyse/SHS Beispieldaten/Wetter.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(...1 = col_datetime(format = "%Y-%m-%d %H:%M:%S"), 
        `2926.Build.ClIn` = col_number(), 
        `2926.Build.Text` = col_number()), 
    trim_ws = TRUE)
View(Weather)

## IWT Data
IWT <- read_delim("C:/Users/Niclas Bardo Bayer/Desktop/Unsortierte Dateien/BAMP Daten Analyse/SHS Beispieldaten/IWT.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(...1 = col_datetime(format = "%Y-%m-%d %H:%M:%S"), 
        Erzeuger = col_skip()), trim_ws = TRUE)
View(IWT)

```
Merging the data to one dataset to perform the modeling. 
Starting only with the variables: 
Occupancy and Total Consumption
To get the occupancy data we shrink the bw_occupancy dataset and use the pivot_wider method to get the occupancy information per room and 15 minutes.
```{r}
## Work on the occupancy Dataset:
bw_occupancy_small <- as.data.frame(bw_occupancy[,c(1,3,6)])
?pivot_wider
bw_occupancy_wide <- pivot_wider(bw_occupancy_small, names_from = "Room", values_from = "Value")

bw_occupancy_wide_time <- bw_occupancy_wide[bw_occupancy_wide$Zeit >= as.POSIXlt("2019-02-14 11:30:00"),]

## Merge the IWT and Occupancy Dataset: 


```

